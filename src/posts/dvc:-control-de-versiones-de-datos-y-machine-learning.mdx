---
title: "DVC: control de versiones de datos y machine learning"
date: 2019-09-17
author: arthur
tags: [control de versiones, machine learning]
description: Data Version Control o el git para versionar datasets y modelos de ML
image: https://dvc.org/img/model-versioning-diagram.png
---

Si haz estado en un proyecto de Machine Learning (ML), muy probablemente empezaste probando con modelos simples (un `LinearRegression` o un `LogisticRegression` por all치) quiz치 daban muy buenos resultados, quiz치 no...luego de un par de d칤as probando modelos o quiza semanas tienes un modelo inicial, simple pero con buenos resultados (como todo buen data scientist anotas todo resultado) y dado que eres Agile decides mostrarlo al cliente. Tienes tu 1ra versi칩n. Sin embargo, al comenzar una nueva semana, tus compa침eros te indican sobre una nueva fuente de datos, una que no habias considerado, que quiza mejorara los resultados, entonces trabajas duro para integrar y limpiar la nueva fuente de datos. Y s칤 como dijeron tus compa침eros, los resultados mejoraron! 游뗵 Otra nueva semana empieza y sabes que puedes mejorar m치s los resultados, decides probar m치s modelos, el lunes avanzas con un `NeuralNetwork`, el martes un `RandomForest`, el miercoles un `AdaBoost`...pero justo el viernes te indican que hay 5000 nuevos registros que probar (antes solo tenias acceso a 3000 registros, pero como las cosas estan yendo bien, te dan mas datos).

Ahora estar치s pensando que tan bien funcionan los modelos que desarrolaste al inicio, quiza con esa nueva data funcionaban bien, 쯤ue haces, conservas los nuevos modelos (y sus hiperparametros) o los deshechas?. Es m치s, en la tarde, un nuevo compa침ero decide usar alguna t칠cnica de selecci칩n de caracteristicas, y te indica que porfavor lo pruebes, quiz치 con eso no sea necesario trabajar con modelos muy pesados 游. Claro que debes probar si esto es verdad, 쯤ue haces?

A estas alturas te hab콋as dado cuenta que en la mayor칤a de **proyectos de machine learning, siempre hay cambios y mucha experimentaci칩n**, al igual que cualquier software!. Claro, esto es el trabajo para un `control de versiones`, al igual que habr치s versionado tu c칩digo fuente (por ejemplo usando Git), quiz치 quieras intentar hacer lo mismo usando Git para tus datasets y modelos. 쯇ero deber칤as versionar tus modelos de ML y sus datasets ah칤?, si son tan pesados, te preguntar치s 쯘ntrar치n en mi servidor de Git (Github, Gitlab...).

## Versionamiento y Machine Learning

Este es [uno de los problemas que la IA, en especifico el Machine Learning, ha traido al area de ingenieria de software](/posts/software-engineering-history). 쯖omo versionamos nuestros modelos y sus datasets?, de tal forma que podamos experimentar modelos, ver que modelos funcionaban con que data y cuales no, y m치s importante poder **reproducir experimentos** de dias anteriores, incluso semanas.

Por suerte, estamos viendo la aplicaci칩n y el desarrollo de versionamiento en esta 치rea de la IA, al [igual que en muchas otras 치reas, no solo de IA](/posts/mas-versionamiento). Una herramienta que es muy 칰til para resolver este problema es [DVC: data version control](https://dvc.org/).

## DVC: data version control

DVC es una herramienta **complementaria a Git**, es decir usamos Git para versionar nuestro c칩digo (como siempre lo hemos hecho!), y DVC para versionar la data y todo modelo de ML (sea de cualquier lenguaje o framework: `R`, `julia`,`scikit-learn`, `weka`...), es decir DVC es agnostica de lenguaje o framework!

Dado que no queremos guardar nuestra data (que usualmente pesa mucho, de MB, GB a ...) en Github o alg칰n servidor de c칩digo, la subimos a alg칰n servidor de almacenamiento en la nube (como Google Storage, Amazon S3 o Azure) o servidor local.

M치s importante DVC nos ayuda con hacer el desarrollo de ML reproducible, podremos probar versiones de nuestro modelo de hace semanas! Y analizar m칠tricas de semanas y meses. Como lo hace? Ello lo hace por enlazar c칩digo y datos con los modelos producidos.

## 쮺omo lo hace?

Por ejemplo, en la figura de abajo, tenemos nuestro codigo (`code`) de entrenamiento de un modelo (por ejemplo en python, un `train.py`), este codigo genera un modelo (en python un pickle, `model.pkl`). Usualmente versionariamos el `train.py` en git, como el modelo. Sin embargo, como dijimos, para modelos pesados git sufre 游땮 y peor con datasets. DVC simplemente crea un archivo que referencia al modelo (`model.pkl.dvc`), el cual no pesa practicamente nada, este archivo sirve como nexo (ver figura de abajo)

![Git y DVC](https://dvc.org/img/model-versioning-diagram.png)

Entonces versionaremos este `model.pkl.dvc` y `train.py` en git, mientras dvc se encarga de versionar el `model.pkl` (que pesa 500mb!). Lo mismo podriamos hacer con datasets. DVC se encargara de versionar nuestros datasets y modelos de la forma m치s eficiente posible, manteniendo siempre la relaci칩n entre el c칩digo y el dataset/modelo 游땎!

Veamos un ejemplo, para entender como funciona git y dvc juntos 游녥

## Ejemplo

Primero debes tener instalado dvc, sino instalalo ejecutando `pip install dvc` (si es que tienes python instalado, puedes ver otras formas de [instalarlo aqu칤](https://dvc.org/doc/get-started/install)).

Imaginare que ya tienes tu proyecto funcionando con git, y simplemente quieres usar dvc, lo 칰nico que debes hacer es:

```bash
$ dvc init
$ git commit -m "Initialize DVC"
```

Una carpeta `.dvc` se creara, donde dvc contiene archivos especiales para funcionar, como la carpeta [cache](https://dvc.org/doc/user-guide/dvc-files-and-directories#structure-of-cache-directory).

Y ahora al igual que en git, agregaremos un servidor remoto, como dijimos podemos trabajar con uno propio o de alg칰n servidor cloud:

```bash
$ dvc remote add -d myremote /tmp/dvc-storage          # en caso de local
$ dvc remote add -d s3remote s3://mybucket/myproject   # en caso de amazon s3 - ojo tendr치s que instalar la librer칤a dvc[s3], m치s detalle en su doc.
```

Ahora a todo dataset o modelo de ML, indicaremos que dvc se encargue de gestionarlo:

```bash
$ dvc add my-dataset.csv
```

DVC crear치 ese archivo referencia, que explicamos antes, en este caso `my-dataset.csv.dvc` (nota el `.dvc` al final del nombre) y agregara al `.gitignore` nuestro archivo `my-dataset.csv` (no queremos que nuestro csv de 50MB lo gestione git). Finalmente, al igual que en git compartiremos nuestro data (en vez de c칩digo) a nuestros compa침eros, subiendolo al repositorio.

```bash
$ dvc push
```

Ellos podran luego bajarse los cambios usando `dvc pull`.

Existen muchas otras caracteristicas que hacen a DVC especialmente 칰til, que para mi son las favoritas como reproducir todo un ML pipeline (usando `dvc repro`) o comparar m칠tricas entre distintas versiones.

Sin embargo, mi tiempo para este articulo se acabo, donde empezar a leer, bueno en su documentaci칩n tienen un tutorial y un [get-started](https://dvc.org/doc/get-started), donde aprender치s el concepto de pipelines usado por dvc, poder regresar a versiones anteriores y como funciona internamente (aunque una gran parte la explique aqu칤 游땔).

> Sin embargo, una de las cosas que me intrigan, es como DVC funciona con bases de datos, a칰n esta es una herramienta que est치 documentando como trabajar con BD. Pero... creo que [desarrollar una aplicaci칩n con Event Sourcing](/posts/eventos-como-mecanismo-de-almacenamiento.mdx) hace una pareja perfecta a Machine Learning, por el hecho de ser en s칤 un versionador de datos!
