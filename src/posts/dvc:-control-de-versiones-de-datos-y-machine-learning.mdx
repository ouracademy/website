---
title: "DVC: control de versiones de datos y machine learning"
date: 2019-09-17
author: arthur
tags: [control de versiones, machine learning]
description: El git para versionar datasets y modelos de ML
---

Si haz estado en un proyecto de Machine Learning (ML), muy probablemente empezaste probando con modelos simples (un `LinearRegression` o un `LogisticRegression`) quiz치 daban muy buenos resultados, quiz치 no... entonces decides regularizarlos o quiz치 probar otros modelos m치s potentes (un `SVM`, un `DecisionTree` por all치...), luego de un par de d칤as o quiza una semana tienes un modelo inicial pero con buenos resultados, dado que eres Agile decides mostrarlo al cliente (y si eres mas arriesgado incluso lanzarlo a producci칩n, como en Continous Delivery), tienes tu 1ra versi칩n, y como todo buen data scientist anotas todo resultado. Sin embargo, al comenzar una nueva semana, tus compa침eros te avisan que ser칤a interesante considerar una nueva fuente de datos, que quiza mejoraran los resultados, entonces trabajas duro para integrar y limpiar la nueva fuente de datos, y s칤 como dijeron tus compa침eros, los resultados mejoraron! Otra nueva semana empieza y sabes que puedes mejorar m치s los resultados, decides probar m치s modelos, el lunes avanzas con un `NeuralNetwork`, el martes un `RandomForest`, el miercoles un `AdaBoost`...pero justo el viernes te indican que hay 5000 nuevos registros que probar (antes solo tuviste acceso a 3000 registros por alguna politica de privacidad, era de un cliente externo,...un motivo X), y que ser칤a bueno ver que tan bien ahora predicen los modelos, 쯤ue haces, conservas los modelos (y sus hiperparametros) que habias seleccionado o los deshechas?. Es m치s a la siguiente semana, un nuevo compa침ero decide usar alguna t칠cnica de selecci칩n de caracteristicas, y te indica que porfavor pruebes con esas nuevas caracteristicas, quiza con eso no sea necesario trabajar con modelos muy pesados, que quiza bastar칤a con un `LinearRegression` 游, claro que debes ver si esto es verdad. que haces?

A estas alturas te hab콋as dado cuenta que en la mayor칤a de proyectos de machine learning, siempre hay cambios y mucha experimentaci칩n, al igual que cualquier software!. Claro, esto es el trabajo para un `control de versiones`, al igual que habr치s versionado tu c칩digo fuente (usando Git o quiza alg칰n otro control de versiones), quiz치 quieras intentar hacer lo mismo usando Git para tus datasets y modelos. 쯇ero deber칤as versionar tus modelos de ML y sus datasets ah칤?, si son tan pesados, te preguntar치s 쯘ntrar치n en mi servidor de Git (Github, Gitlab...).

Este es [uno de los problemas que la IA, en especifico el Machine Learning, ha traido al area de ingenieria de software](/posts/software-engineering-history). 쯖omo versionamos nuestros modelos y sus datasets?, de tal forma que podamos experimentar modelos, ver que modelos funcionaban con que data y cuales no, y m치s importante poder **reproducir experimentos**.

Por suerte, estamos viendo la aplicaci칩n y el desarrollo de versionamiento en esta 치rea al [igual que en muchas otras 치reas](/posts/mas-versionamiento). Una herramienta que es muy 칰til para resolver este problema es [DVC: data version control](https://dvc.org/).

DVC es una herramienta complementaria a Git, es decir usamos Git para versionar nuestro c칩digo (como siempre lo hemos hecho!), y DVC para versionar la data y todo modelo de ML (sea de cualquier lenguaje o framework: `R`, `julia`,`scikit-learn`, `weka`...). Dado que no queremos guardar nuestra data (que usualmente pesa mucho, de MB, GB a ...) en Github o alg칰n servidor de c칩digo, la subimos a alg칰n servidor de almacenamiento en la nube (como Google Storage, Amazon S3 o Azure) o quiz치 nuestro propio servidor local.

![Git y DVC](https://dvc.org/static/img/model-versioning-diagram.png)

DVC se encargara de versionar nuestros datasets y modelos de la forma m치s eficiente posible, manteniendo siempre la relaci칩n entre el c칩digo y la data. 쮺omo? Bueno tu c칩digo lee y transforma datos (los limpias, escoges las caracteristicas) , y con ello construye modelos. Por ejemplo, en la imagen de arriba, el codigo (`code`) produce un modelo (`model.pkl` en caso de usar python), dado que no queremos almacenar ese `model.pkl` en nuestro versionador de codigo, pero queremos mantener la relaci칩n que el "`code` creo el `model.pkl`" en un determinado `commit`, DVC se encarga de ello, creando un archivo `model.pkl.dvc` que funciona como una referencia al `model.pkl` original, el modelo original (`model.pkl`) es ahora excluido de Git (se le agrega al `.gitignore`), sin embargo git ahora guardar치 el `model.pkl.dvc` y dado que este es una referencia al modelo original, pues tenemos la relaci칩n entre el codigo y el dataset/modelo 游땎!

Veamos un ejemplo, para entender como funciona git y dvc juntos 游녥

Primero debes tener instalado dvc, sino instalalo ejecutando `pip install dvc` (si es que tienes python instalado, puedes ver otras formas de [instalarlo aqu칤](https://dvc.org/doc/get-started/install)).

Imaginare que ya tienes tu proyecto funcionando con git, y simplemente quieres usar dvc, lo 칰nico que debes hacer es:

```bash
$ dvc init
$ git commit -m "Initialize DVC"
```

Una carpeta `.dvc` se creara, donde dvc contiene archivos especiales para funcionar, como la carpeta [cache](https://dvc.org/doc/user-guide/dvc-files-and-directories#structure-of-cache-directory).

Y ahora al igual que en git, agregaremos un servidor remoto, como dijimos podemos trabajar con uno propio o de alg칰n servidor cloud:

```bash
$ dvc remote add -d myremote /tmp/dvc-storage          # en caso de local
$ dvc remote add -d s3remote s3://mybucket/myproject   # en caso de amazon s3 - ojo tendr치s que instalar la librer칤a dvc[s3], m치s detalle en su doc.
```

Ahora a todo dataset o modelo de ML, indicaremos que dvc se encargue de gestionarlo:

```bash
$ dvc add my-dataset.csv
```

DVC crear치 ese archivo referencia, que explicamos antes, en este caso `my-dataset.csv.dvc` (nota el `.dvc` al final del nombre) y agregara al `.gitignore` nuestro archivo `my-dataset.csv` (no queremos que nuestro csv de 50MB lo gestione git). Finalmente, al igual que en git compartiremos nuestro data (en vez de c칩digo) a nuestros compa침eros, subiendolo al repositorio.

```bash
$ dvc push
```

Ellos podran luego bajarse los cambios usando `dvc pull`. Existen muchas otras caracteristicas que hacen a DVC especialmente 칰til, sin embargo, mi tiempo para este articulo se acabo, donde empezar a leer, bueno en su documentaci칩n tienen un tutorial y un [get-started](https://dvc.org/doc/get-started), donde aprender치s el concepto de pipelines usado por dvc, poder regresar a versiones anteriores y como funciona internamente (aunque una gran parte la explique aqu칤 游땔).
